<div class = "container">
  <!-- start of device location -->
  <div id="map"></div>
  <div class="row">
    <div class="col-md-12">

      <style>
      #map {
        height: 400px;
        width: 100%;
      }
    </style>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQRhtkZcgjstdOhIaPtkrMkvwvKbePDak"></script>


    <script>
      function success(position){
        var mylat = position.coords.latitude;
        var mylong = position.coords.longitude;

        var coords = new google.maps.LatLng(mylat, mylong);

        var mapOptions = {
          zoom: 16,
          center: coords,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }

        var map = new google.maps.Map(document.getElementById("map"), mapOptions);
//add a marker//

var marker = new google.maps.Marker({
  position:{lat: mylat, lng: mylong},
  map: map, 
  icon: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
});

var infoWindow = new google.maps.InfoWindow({
  content: '<h5>You are here </h5>'
});

marker.addListener('click', function(){
  infoWindow.open(map, marker);
});


var supporterCoords = <%= @a.to_json %>
supporterCoords.forEach(function(element){
  new google.maps.Marker({
    position:{lat: element[0], lng: element[1]},
    map: map
  });
})
}

function failure(){
  $('body').append("<p>It didnâ€™t work, co-ordinates are not available!</p>")
}

x = navigator.geolocation;
x.getCurrentPosition(success, failure);

</script>
</div>
</div>
<!-- end of device location -->


<p id="notice"><%= notice %></p>

<h1>Posts</h1>
<div class="all_listings">

  <!--  sort -->
  <div class="sortable_bar">
    <%= sortable "id", "Newest " %>
  </div>

  <!--  sort -->
  <!-- allposts -->
  <div  id="container">
    <div class="row">
      <% @posts.each_slice(3) do |posts| %>

      <% posts.each do |post| %>
      <% if post.ordered_post == false &&   post.deadline_for_collection >( Time.now - (60*60*24))  %>

      <section class="col-xs-18 col-sm-6 col-md-4">
        <div class="thumbnail">

          <% if post.photos? %> 
          <%= link_to (image_tag post.photos[0].small,:class => "thum"),post_path(post) %>
          <% else %>
          <%= link_to (image_tag 'default.jpg',:class => "thum" ),post_path(post)%>  
          <% end %>

          <div class="caption">
            <p>ordered | <td><%= post.ordered_post %></td></p>
            <p>Title | <td><%= post.title %></td></p>
            <p>Description | <td><%= post.description %></td></p>
            <p>Pickup before | <td><%= post.deadline_for_collection.to_date %></td></p>
            <% if current_user.class == Charity %> 
            <a href="/posts/<%= post.id %>/orders/new">Order</a>
            <% end %>     
          </div>
        </div>
      </section>
      <% else %>
      <% end %>
      <% end %>
      <% end %>
    </div><!-- End row -->
  </div><!-- End container -->
</div>
<!-- allposts -->
<br>
</div>
